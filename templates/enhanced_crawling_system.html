<!DOCTYPE html>
<html>
<head>
    <title>Enhanced arXiv Paper System</title>
    <meta charset="utf-8">
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.js"></script>
    <style>
        body { font-family: Arial; margin: 0; background: #f5f5f5; }
        .MainContainer { max-width: 1400px; margin: 0 auto; background: white; min-height: 100vh; }
        .TabContainer { display: flex; background: #343a40; }
        .TabButton { flex: 1; padding: 15px; background: #495057; color: white; border: none; cursor: pointer; }
        .TabButton.active { background: #007bff; }
        .TabContent { display: none; padding: 20px; }
        .TabContent.active { display: block; }
        .ControlPanel { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .ControlGroup { background: #f8f9fa; padding: 15px; border-radius: 6px; }
        .PlatformSelector { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 10px 0; }
        .PlatformButton { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; background: #6c757d; color: white; }
        .PlatformButton.active { background: #28a745; }
        .PlatformButton.error { background: #dc3545; }
        .InputGroup { margin: 10px 0; }
        .InputGroup input, .InputGroup select { width: 100px; padding: 5px; }
        .ActionButton { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .ActionButton:hover { background: #218838; }
        .ActionButton.primary { background: #007bff; }
        .ActionButton.primary:hover { background: #0056b3; }
        .StatusDisplay { margin: 20px 0; padding: 10px; background: #e9ecef; border-radius: 4px; }
        .PaperList { margin-top: 20px; }
        .PaperItem { background: white; border: 1px solid #dee2e6; margin: 10px 0; padding: 15px; border-radius: 6px; position: relative; }
        .PaperTitle { font-weight: bold; margin-bottom: 5px; color: #0066cc; }
        .PaperMeta { color: #666; font-size: 0.9em; margin: 5px 0; }
        .PaperAbstract { margin-top: 10px; line-height: 1.4; }
        .PaperActions { position: absolute; top: 10px; right: 10px; }
        .SmallButton { padding: 5px 10px; margin: 2px; border: none; border-radius: 3px; cursor: pointer; font-size: 0.8em; }
        .SmallButton.primary { background: #007bff; color: white; }
        .SmallButton.success { background: #28a745; color: white; }
        .loading { opacity: 0.5; pointer-events: none; }
        .PlatformStatus { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 15px 0; }
        .StatusCard { background: white; border-radius: 6px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .StatusCard.success { border-left: 4px solid #28a745; }
        .StatusCard.error { border-left: 4px solid #dc3545; }
        .CategorySelector { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .CategoryTag { padding: 4px 8px; background: #e9ecef; border: 1px solid #ced4da; border-radius: 4px; cursor: pointer; font-size: 0.8em; }
        .CategoryTag.selected { background: #007bff; color: white; }
    </style>
</head>
<body>
    <div class="MainContainer">
        <div class="TabContainer">
            <button class="TabButton active" onclick="showTab('crawlSetup')">í¬ë¡¤ë§ ì„¤ì •</button>
            <button class="TabButton" onclick="showTab('crawlResults')">í¬ë¡¤ë§ ê²°ê³¼</button>
            <button class="TabButton" onclick="showTab('database')">DB ë…¼ë¬¸ ì¡°íšŒ</button>
            <button class="TabButton" onclick="showTab('papers')">ë…¼ë¬¸ ê°¤ëŸ¬ë¦¬</button>
            <button class="TabButton" onclick="showTab('analysis')">AI ë¶„ì„</button>
            <button class="TabButton" onclick="showTab('citation')">Citation Graph</button>
        </div>

        <!-- í¬ë¡¤ë§ ì„¤ì • íƒ­ -->
        <div id="CrawlSetupTab" class="TabContent active">
            <h2>ğŸš€ í¬ë¡¤ë§ ì„¤ì •</h2>
            
            <div class="ControlPanel">
                <div class="ControlGroup">
                    <h3>í”Œë«í¼ ìƒíƒœ</h3>
                    <button class="ActionButton primary" onclick="loadPlatformStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
                    <div class="PlatformStatus" id="PlatformStatusContainer">
                        ë¡œë”© ì¤‘...
                    </div>
                </div>

                <div class="ControlGroup">
                    <h3>í”Œë«í¼ ì„ íƒ</h3>
                    <div class="PlatformSelector" id="PlatformSelector">
                        ë¡œë”© ì¤‘...
                    </div>
                    <button class="ActionButton" onclick="selectAllPlatforms()">ì „ì²´ ì„ íƒ</button>
                    <button class="ActionButton" onclick="clearPlatformSelection()">ì„ íƒ í•´ì œ</button>
                </div>

                <div class="ControlGroup">
                    <h3>í¬ë¡¤ë§ ì„¤ì •</h3>
                    <div class="InputGroup">
                        í”Œë«í¼ë‹¹ ë…¼ë¬¸ ìˆ˜: <input type="number" id="LimitPerPlatform" value="20" min="1" max="100">
                    </div>
                    <div class="CategorySelector" id="CategorySelector">
                        <div class="CategoryTag selected" onclick="toggleCategory('cs.AI')">cs.AI</div>
                        <div class="CategoryTag selected" onclick="toggleCategory('cs.LG')">cs.LG</div>
                        <div class="CategoryTag" onclick="toggleCategory('cs.CV')">cs.CV</div>
                        <div class="CategoryTag" onclick="toggleCategory('cs.CL')">cs.CL</div>
                    </div>
                    <div class="InputGroup">
                        <button class="ActionButton" onclick="startMultiPlatformCrawl()">ğŸš€ ë©€í‹°í”Œë«í¼ í¬ë¡¤ë§ ì‹œì‘</button>
                        <button class="ActionButton primary" onclick="startArxivCrawl()">ğŸ“œ arXiv ë‹¨ë… í¬ë¡¤ë§</button>
                        <button class="ActionButton primary" onclick="startRSSCrawl()">ğŸ“¡ RSS í¬ë¡¤ë§</button>
                    </div>
                </div>
            </div>
            
            <div class="StatusDisplay" id="CrawlSetupStatus">Ready - í”Œë«í¼ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
        </div>

        <!-- í¬ë¡¤ë§ ê²°ê³¼ íƒ­ -->
        <div id="CrawlResultsTab" class="TabContent">
            <h2>ğŸ“Š í¬ë¡¤ë§ ê²°ê³¼</h2>
            
            <div class="StatusDisplay" id="CrawlResultsStatus">í¬ë¡¤ë§ ì§„í–‰ ìƒí™©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
            <div class="PaperList" id="CrawlResultsPapers"></div>
        </div>

        <!-- ê¸°ì¡´ íƒ­ë“¤ (DB ì¡°íšŒ, ë…¼ë¬¸ ê°¤ëŸ¬ë¦¬, AI ë¶„ì„, Citation Graph) -->
        <div id="DatabaseTab" class="TabContent">
            <h2>ë°ì´í„°ë² ì´ìŠ¤ ë…¼ë¬¸ ì¡°íšŒ</h2>
            <div class="StatusDisplay" id="DBStatus">DB ì¡°íšŒ ê¸°ëŠ¥</div>
        </div>

        <div id="PapersTab" class="TabContent">
            <h2>ë…¼ë¬¸ ê°¤ëŸ¬ë¦¬</h2>
            <div class="StatusDisplay" id="PapersStatus">ë…¼ë¬¸ ê°¤ëŸ¬ë¦¬ ê¸°ëŠ¥</div>
        </div>

        <div id="AnalysisTab" class="TabContent">
            <h2>AI ë¶„ì„</h2>
            <div class="StatusDisplay" id="AnalysisStatus">AI ë¶„ì„ ê¸°ëŠ¥</div>
        </div>

        <div id="CitationTab" class="TabContent">
            <h2>Citation Graph</h2>
            <div class="StatusDisplay" id="CitationStatus">Citation Graph ê¸°ëŠ¥</div>
        </div>
    </div>

    <script>
        let selectedPlatforms = [];
        let selectedCategories = ['cs.AI', 'cs.LG'];
        let availablePlatforms = {};
        let currentCrawlResult = null;

        function showTab(tabName) {
            document.querySelectorAll('.TabContent').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.TabButton').forEach(btn => btn.classList.remove('active'));
            
            const tabElement = document.getElementById(tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab');
            const buttonElement = event.target;
            
            if (tabElement) tabElement.classList.add('active');
            if (buttonElement) buttonElement.classList.add('active');
            
            if (tabName === 'crawlSetup') {
                loadPlatformStatus();
            }
        }

        async function loadPlatformStatus() {
            const statusContainer = document.getElementById('PlatformStatusContainer');
            const platformSelector = document.getElementById('PlatformSelector');
            const statusEl = document.getElementById('CrawlSetupStatus');
            
            statusEl.textContent = 'í”Œë«í¼ ìƒíƒœ í™•ì¸ ì¤‘...';
            statusContainer.innerHTML = 'ë¡œë”© ì¤‘...';
            platformSelector.innerHTML = 'ë¡œë”© ì¤‘...';
            
            try {
                const [platformsResponse, statusResponse] = await Promise.all([
                    fetch('/api/v1/platforms'),
                    fetch('/api/v1/crawling-status')
                ]);
                
                const platformsData = await platformsResponse.json();
                const statusData = await statusResponse.json();
                
                if (platformsData.error || statusData.error) {
                    statusEl.textContent = `ì˜¤ë¥˜: ${platformsData.error || statusData.error}`;
                    return;
                }
                
                availablePlatforms = platformsData.platforms;
                renderPlatformStatus(statusData);
                renderPlatformSelector(platformsData.platforms);
                
                statusEl.textContent = `í”Œë«í¼ ìƒíƒœ: ${statusData.active_platforms}/${statusData.total_platforms} í™œì„±í™”`;
                
            } catch (error) {
                statusEl.textContent = `ì˜¤ë¥˜: ${error.message}`;
                statusContainer.innerHTML = 'ì˜¤ë¥˜ ë°œìƒ';
                platformSelector.innerHTML = 'ì˜¤ë¥˜ ë°œìƒ';
            }
        }

        function renderPlatformStatus(statusData) {
            const container = document.getElementById('PlatformStatusContainer');
            
            const statusCards = Object.entries(statusData.platform_details).map(([platform, details]) => {
                const statusClass = details.status === 'success' ? 'success' : 'error';
                return `
                    <div class="StatusCard ${statusClass}">
                        <h4>${platform.toUpperCase()}</h4>
                        <div>ìƒíƒœ: ${details.status === 'success' ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜'}</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                            ${details.message}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = statusCards;
        }

        function renderPlatformSelector(platforms) {
            const container = document.getElementById('PlatformSelector');
            
            const platformButtons = Object.entries(platforms).map(([platform, info]) => {
                const statusClass = info.status === 'success' ? '' : 'error';
                const activeClass = selectedPlatforms.includes(platform) ? 'active' : '';
                
                return `
                    <button class="PlatformButton ${statusClass} ${activeClass}" 
                            onclick="togglePlatform('${platform}')"
                            ${info.status !== 'success' ? 'disabled' : ''}>
                        ${info.name}
                        <div style="font-size: 0.7em;">${info.categories.length} ì¹´í…Œê³ ë¦¬</div>
                    </button>
                `;
            }).join('');
            
            container.innerHTML = platformButtons;
        }

        function togglePlatform(platform) {
            const index = selectedPlatforms.indexOf(platform);
            if (index === -1) {
                selectedPlatforms.push(platform);
            } else {
                selectedPlatforms.splice(index, 1);
            }
            
            updatePlatformButtons();
            document.getElementById('CrawlSetupStatus').textContent = 
                `ì„ íƒëœ í”Œë«í¼: ${selectedPlatforms.join(', ') || 'ì—†ìŒ'}`;
        }

        function updatePlatformButtons() {
            document.querySelectorAll('.PlatformButton').forEach(btn => {
                const platform = btn.onclick.toString().match(/'([^']+)'/)[1];
                if (selectedPlatforms.includes(platform)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function selectAllPlatforms() {
            selectedPlatforms = Object.keys(availablePlatforms).filter(
                platform => availablePlatforms[platform].status === 'success'
            );
            updatePlatformButtons();
            document.getElementById('CrawlSetupStatus').textContent = 
                `ëª¨ë“  í”Œë«í¼ ì„ íƒë¨: ${selectedPlatforms.join(', ')}`;
        }

        function clearPlatformSelection() {
            selectedPlatforms = [];
            updatePlatformButtons();
            document.getElementById('CrawlSetupStatus').textContent = 'í”Œë«í¼ ì„ íƒ í•´ì œë¨';
        }

        function toggleCategory(category) {
            const index = selectedCategories.indexOf(category);
            if (index === -1) {
                selectedCategories.push(category);
            } else {
                selectedCategories.splice(index, 1);
            }
            
            document.querySelectorAll('.CategoryTag').forEach(tag => {
                const tagCategory = tag.onclick.toString().match(/'([^']+)'/)[1];
                if (selectedCategories.includes(tagCategory)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });
        }

        async function startMultiPlatformCrawl() {
            if (selectedPlatforms.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ í”Œë«í¼ì„ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            const limit = document.getElementById('LimitPerPlatform').value;
            const statusEl = document.getElementById('CrawlSetupStatus');
            
            statusEl.textContent = `ë©€í‹°í”Œë«í¼ í¬ë¡¤ë§ ì‹œì‘... (${selectedPlatforms.join(', ')})`;
            document.body.classList.add('loading');
            
            try {
                const response = await fetch('/api/v1/multi-crawl', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        platforms: selectedPlatforms,
                        categories: selectedCategories.length > 0 ? selectedCategories : null,
                        limit_per_platform: parseInt(limit)
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    currentCrawlResult = result;
                    statusEl.textContent = `í¬ë¡¤ë§ ì™„ë£Œ! ì´ ${result.total_saved}ê°œ ë…¼ë¬¸ ì €ì¥ë¨`;
                    showCrawlResults(result);
                } else {
                    statusEl.textContent = `í¬ë¡¤ë§ ì‹¤íŒ¨: ${result.error}`;
                }
                
            } catch (error) {
                statusEl.textContent = `ì˜¤ë¥˜: ${error.message}`;
            }
            
            document.body.classList.remove('loading');
        }

        async function startArxivCrawl() {
            const statusEl = document.getElementById('CrawlSetupStatus');
            statusEl.textContent = 'arXiv í¬ë¡¤ë§ ì‹œì‘...';
            
            try {
                const response = await fetch('/api/v1/crawl', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain: 'cs',
                        category: selectedCategories[0] || null,
                        days_back: 0,
                        limit: parseInt(document.getElementById('LimitPerPlatform').value)
                    })
                });
                
                const result = await response.json();
                statusEl.textContent = result.status === 'success' ? 
                    `arXiv í¬ë¡¤ë§ ì™„ë£Œ: ${result.saved_count}ê°œ ì €ì¥` : 
                    `arXiv í¬ë¡¤ë§ ì‹¤íŒ¨: ${result.error}`;
                    
            } catch (error) {
                statusEl.textContent = `arXiv í¬ë¡¤ë§ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        async function startRSSCrawl() {
            const statusEl = document.getElementById('CrawlSetupStatus');
            statusEl.textContent = 'RSS í¬ë¡¤ë§ ì‹œì‘...';
            
            try {
                const response = await fetch('/api/v1/crawl-rss', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain: 'cs',
                        category: selectedCategories[0] || null,
                        limit: parseInt(document.getElementById('LimitPerPlatform').value)
                    })
                });
                
                const result = await response.json();
                statusEl.textContent = result.status === 'success' ? 
                    `RSS í¬ë¡¤ë§ ì™„ë£Œ: ${result.saved_count}ê°œ ì €ì¥` : 
                    `RSS í¬ë¡¤ë§ ì‹¤íŒ¨: ${result.error}`;
                    
            } catch (error) {
                statusEl.textContent = `RSS í¬ë¡¤ë§ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        function showCrawlResults(result) {
            const statusEl = document.getElementById('CrawlResultsStatus');
            
            const platformResults = Object.entries(result.platform_results).map(([platform, platformResult]) => {
                const statusIcon = platformResult.status === 'success' ? 'âœ…' : 'âŒ';
                const statusText = platformResult.status === 'success' ? 
                    `${platformResult.saved_count}ê°œ ë…¼ë¬¸ ì €ì¥` : 
                    `ì˜¤ë¥˜: ${platformResult.error}`;
                
                return `${statusIcon} ${platform.toUpperCase()}: ${statusText}`;
            }).join(' | ');
            
            statusEl.innerHTML = `
                <strong>í¬ë¡¤ë§ ì™„ë£Œ!</strong><br>
                ì´ ì €ì¥ëœ ë…¼ë¬¸: ${result.total_saved}ê°œ<br>
                í¬ë¡¤ë§ ì‹œê°„: ${new Date().toLocaleString()}<br>
                í”Œë«í¼ë³„ ê²°ê³¼: ${platformResults}
            `;
            
            showTab('crawlResults');
        }

        function analyzePaper(arxivId) {
            alert(`AI ë¶„ì„ ê¸°ëŠ¥: ${arxivId}`);
        }

        // ì´ˆê¸° ë¡œë“œ
        loadPlatformStatus();
    </script>
</body>
</html>
