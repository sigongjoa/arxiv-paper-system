<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperShorts ì¸ì¦ í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .auth-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .auth-section:hover {
            border-color: #4CAF50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
        }

        .auth-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .trust-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-orcid { background: #A6CE39; color: white; }
        .badge-doi { background: #0066CC; color: white; }
        .badge-student { background: #FFB347; color: white; }
        .badge-guest { background: #999; color: white; }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-orcid {
            background: linear-gradient(135deg, #A6CE39 0%, #8DB700 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .user-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .comment-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .comment {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }

        .comment-meta {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .hidden {
            display: none;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            resize: vertical;
            min-height: 100px;
        }

        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .filter-tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .filter-tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tab.active {
            background: #4CAF50;
            color: white;
        }

        .filter-tab:first-child {
            border-radius: 8px 0 0 8px;
        }

        .filter-tab:last-child {
            border-radius: 0 8px 8px 0;
        }

        .navigation {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .nav-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
    </style>
</head>
<body>
    <div class="navigation">
        <a href="/" class="nav-btn">ğŸ“š ê²Œì‹œíŒìœ¼ë¡œ</a>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“š PaperShorts</h1>
            <p>ë…¼ë¬¸ì‡¼ì¸  ì¸ì¦ ê¸°ë°˜ ëŒ“ê¸€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</p>
        </div>

        <div class="content">
            <!-- ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ -->
            <div id="userInfo" class="user-info hidden">
                <h3>ë¡œê·¸ì¸ ì •ë³´</h3>
                <div id="userDetails"></div>
                <button class="btn btn-secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>

            <!-- ì¼ë°˜ ë¡œê·¸ì¸/íšŒì›ê°€ì… -->
            <div id="authForms" class="auth-section">
                <h2>ğŸ” ì¼ë°˜ ë¡œê·¸ì¸ <span class="trust-badge badge-guest">GUEST</span></h2>
                
                <div style="display: flex; gap: 20px;">
                    <!-- ë¡œê·¸ì¸ í¼ -->
                    <div style="flex: 1;">
                        <h4>ë¡œê·¸ì¸</h4>
                        <div class="form-group">
                            <label for="loginEmail">ì´ë©”ì¼</label>
                            <input type="email" id="loginEmail" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                        </div>
                        <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
                    </div>

                    <!-- íšŒì›ê°€ì… í¼ -->
                    <div style="flex: 1;">
                        <h4>íšŒì›ê°€ì…</h4>
                        <div class="form-group">
                            <label for="registerUsername">ì‚¬ìš©ìëª…</label>
                            <input type="text" id="registerUsername" placeholder="ì‚¬ìš©ìëª…">
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">ì´ë©”ì¼</label>
                            <input type="email" id="registerEmail" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="registerPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
                        </div>
                        <button class="btn" onclick="register()">íšŒì›ê°€ì…</button>
                    </div>
                </div>
            </div>

            <!-- ORCID ì¸ì¦ -->
            <div class="auth-section">
                <h2>ğŸ“ ORCID ì¸ì¦ <span class="trust-badge badge-orcid">ORCID</span></h2>
                <p style="margin-bottom: 15px;">ì—°êµ¬ì ì‹ ì› í™•ì¸ì„ ìœ„í•œ ORCID ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.</p>
                <button class="btn btn-orcid" onclick="orcidLogin()">ORCIDë¡œ ë¡œê·¸ì¸</button>
            </div>

            <!-- ì¶”ê°€ ì¸ì¦ ì„¹ì…˜ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
            <div id="additionalAuth" class="hidden">
                <!-- DOI ì¸ì¦ -->
                <div class="auth-section">
                    <h2>ğŸ“„ DOI ì €ì ì¸ì¦ <span class="trust-badge badge-doi">DOI</span></h2>
                    <p style="margin-bottom: 15px;">ë°œí‘œí•œ ë…¼ë¬¸ì˜ DOIë¥¼ ì…ë ¥í•˜ì—¬ ì €ì ì‹ ì›ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                    <div class="form-group">
                        <label for="doiInput">DOI (ì˜ˆ: 10.1016/j.cell.2021.01.001)</label>
                        <input type="text" id="doiInput" placeholder="10.xxxx/yyyyy">
                    </div>
                    <button class="btn" onclick="verifyDoi()">DOI ê²€ì¦</button>
                </div>

                <!-- í•™ìƒ ì´ë©”ì¼ ì¸ì¦ -->
                <div class="auth-section">
                    <h2>ğŸ’ í•™ìƒ ì¸ì¦ <span class="trust-badge badge-student">STUDENT</span></h2>
                    <p style="margin-bottom: 15px;">ëŒ€í•™ ì´ë©”ì¼ (.ac.kr, .edu)ë¡œ í•™ìƒ ì‹ ì›ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                    <div class="form-group">
                        <label for="studentEmail">ëŒ€í•™ ì´ë©”ì¼</label>
                        <input type="email" id="studentEmail" placeholder="student@university.ac.kr">
                    </div>
                    <button class="btn" onclick="sendStudentVerification()">ì¸ì¦ ë©”ì¼ ë°œì†¡</button>
                </div>
            </div>

            <!-- ëŒ“ê¸€ í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div id="commentSection" class="comment-section hidden">
                <h2>ğŸ’¬ ëŒ“ê¸€ í…ŒìŠ¤íŠ¸</h2>
                
                <!-- ëŒ“ê¸€ ì‘ì„± -->
                <div class="form-group">
                    <label for="commentContent">ëŒ“ê¸€ ë‚´ìš©</label>
                    <textarea id="commentContent" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                <button class="btn" onclick="postComment()">ëŒ“ê¸€ ì‘ì„±</button>

                <!-- ëŒ“ê¸€ í•„í„° -->
                <div class="filter-tabs">
                    <div class="filter-tab active" onclick="filterComments('all')">ì „ì²´ ëŒ“ê¸€</div>
                    <div class="filter-tab" onclick="filterComments('verified_only')">ì¸ì¦ëœ ëŒ“ê¸€</div>
                    <div class="filter-tab" onclick="filterComments('guest_only')">ê²ŒìŠ¤íŠ¸ ëŒ“ê¸€</div>
                </div>

                <!-- ëŒ“ê¸€ ëª©ë¡ -->
                <div id="commentsList"></div>
            </div>

            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="statusMessage"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let currentUser = null;
        let currentFilter = 'all';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadComments();
            handleAuthCallbacks();
        });

        // URLì—ì„œ ì¸ì¦ ì½œë°± ì²˜ë¦¬
        function handleAuthCallbacks() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const refresh = urlParams.get('refresh');
            const error = urlParams.get('message');

            if (token && refresh) {
                localStorage.setItem('accessToken', token);
                localStorage.setItem('refreshToken', refresh);
                showStatus('ORCID ì¸ì¦ ì„±ê³µ!', 'success');
                checkAuth();
                // URL ì •ë¦¬
                window.history.replaceState({}, document.title, window.location.pathname);
            } else if (error) {
                showStatus(error, 'error');
                // URL ì •ë¦¬
                window.history.replaceState({}, document.title, window.location.pathname);
            }

            // ì´ë©”ì¼ ì¸ì¦ í† í° í™•ì¸
            const emailToken = urlParams.get('token');
            if (emailToken && window.location.pathname.includes('/auth/student/verify')) {
                verifyEmailToken(emailToken);
            }
        }

        // ì¸ì¦ ìƒíƒœ í™•ì¸
        async function checkAuth() {
            const token = localStorage.getItem('accessToken');
            if (!token) {
                showGuestMode();
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    showUserInfo(data.user);
                } else {
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('refreshToken');
                    showGuestMode();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                showGuestMode();
            }
        }

        function showUserInfo(user) {
            document.getElementById('authForms').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('additionalAuth').classList.remove('hidden');
            document.getElementById('commentSection').classList.remove('hidden');

            const badges = {
                'ORCID': '<span class="trust-badge badge-orcid">ORCID ì¸ì¦</span>',
                'DOI': '<span class="trust-badge badge-doi">DOI ì¸ì¦</span>',
                'STUDENT': '<span class="trust-badge badge-student">í•™ìƒ ì¸ì¦</span>',
                'GUEST': '<span class="trust-badge badge-guest">ê²ŒìŠ¤íŠ¸</span>'
            };

            document.getElementById('userDetails').innerHTML = `
                <p><strong>ì‚¬ìš©ìëª…:</strong> ${user.username} ${badges[user.trustLevel] || ''}</p>
                <p><strong>ì´ë©”ì¼:</strong> ${user.email || 'N/A'}</p>
                <p><strong>ì‹ ë¢°ë„ ë ˆë²¨:</strong> ${user.trustLevel}</p>
                ${user.orcid ? `<p><strong>ORCID:</strong> ${user.orcid}</p>` : ''}
                ${user.verifiedDetail ? `<p><strong>ì¸ì¦ ì •ë³´:</strong> ${user.verifiedDetail}</p>` : ''}
                <p><strong>ê°€ì…ì¼:</strong> ${new Date(user.createdAt).toLocaleString()}</p>
            `;
        }

        function showGuestMode() {
            document.getElementById('authForms').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('additionalAuth').classList.add('hidden');
            document.getElementById('commentSection').classList.add('hidden');
        }

        // ë¡œê·¸ì¸
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showStatus('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('accessToken', data.tokens.accessToken);
                    localStorage.setItem('refreshToken', data.tokens.refreshToken);
                    showStatus('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                    checkAuth();
                } else {
                    showStatus(data.error || 'ë¡œê·¸ì¸ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // íšŒì›ê°€ì…
        async function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            if (!username || !email || !password) {
                showStatus('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('accessToken', data.tokens.accessToken);
                    localStorage.setItem('refreshToken', data.tokens.refreshToken);
                    showStatus('íšŒì›ê°€ì… ì„±ê³µ!', 'success');
                    checkAuth();
                } else {
                    showStatus(data.error || 'íšŒì›ê°€ì… ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ORCID ë¡œê·¸ì¸
        async function orcidLogin() {
            try {
                const response = await fetch(`${API_BASE}/auth/orcid/login`);
                const data = await response.json();
                
                if (response.ok) {
                    window.location.href = data.authUrl;
                } else {
                    showStatus('ORCID ì¸ì¦ URL ìƒì„± ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // DOI ê²€ì¦
        async function verifyDoi() {
            const doi = document.getElementById('doiInput').value;
            const token = localStorage.getItem('accessToken');

            if (!doi) {
                showStatus('DOIë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            if (!token) {
                showStatus('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/doi/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ doi })
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('DOI ì¸ì¦ ì„±ê³µ!', 'success');
                    checkAuth();
                } else {
                    showStatus(data.error || 'DOI ì¸ì¦ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í•™ìƒ ì´ë©”ì¼ ì¸ì¦ ìš”ì²­
        async function sendStudentVerification() {
            const email = document.getElementById('studentEmail').value;
            const token = localStorage.getItem('accessToken');

            if (!email) {
                showStatus('ëŒ€í•™ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            if (!token) {
                showStatus('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/student/email-request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus('ì¸ì¦ ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”.', 'success');
                } else {
                    showStatus(data.error || 'ì¸ì¦ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì´ë©”ì¼ í† í° ê²€ì¦
        async function verifyEmailToken(token) {
            try {
                const response = await fetch(`${API_BASE}/auth/student/email-verify?token=${token}`);
                const data = await response.json();

                if (response.ok) {
                    showStatus('í•™ìƒ ì´ë©”ì¼ ì¸ì¦ ì„±ê³µ!', 'success');
                    checkAuth();
                } else {
                    showStatus(data.error || 'ì´ë©”ì¼ ì¸ì¦ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            currentUser = null;
            showGuestMode();
            showStatus('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // ëŒ“ê¸€ ì‘ì„±
        async function postComment() {
            const content = document.getElementById('commentContent').value;
            const token = localStorage.getItem('accessToken');

            if (!content.trim()) {
                showStatus('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            if (!token) {
                showStatus('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/comments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        post_id: 1, // í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œê¸€ ID
                        content: content.trim()
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showStatus(data.message, 'success');
                    document.getElementById('commentContent').value = '';
                    loadComments();
                } else {
                    showStatus(data.error || 'ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                showStatus('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ
        async function loadComments() {
            try {
                const response = await fetch(`${API_BASE}/comments/post/1?filter=${currentFilter}`);
                const data = await response.json();

                if (response.ok) {
                    displayComments(data.comments);
                } else {
                    console.error('Failed to load comments:', data.error);
                }
            } catch (error) {
                console.error('Network error loading comments:', error);
            }
        }

        // ëŒ“ê¸€ í‘œì‹œ
        function displayComments(comments) {
            const commentsList = document.getElementById('commentsList');
            
            if (comments.length === 0) {
                commentsList.innerHTML = '<p style="text-align: center; color: #666;">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const badges = {
                'ORCID': '<span class="trust-badge badge-orcid">ORCID</span>',
                'DOI': '<span class="trust-badge badge-doi">DOI</span>',
                'STUDENT': '<span class="trust-badge badge-student">STUDENT</span>',
                'GUEST': '<span class="trust-badge badge-guest">GUEST</span>'
            };

            commentsList.innerHTML = comments.map(comment => `
                <div class="comment">
                    <div class="comment-meta">
                        <strong>${comment.username}</strong> 
                        ${badges[comment.trust_level] || ''}
                        <span style="margin-left: 10px; color: #999;">
                            ${new Date(comment.created_at).toLocaleString()}
                        </span>
                        ${!comment.is_approved ? '<span style="color: #ff6b6b; margin-left: 10px;">(ìŠ¹ì¸ ëŒ€ê¸°)</span>' : ''}
                    </div>
                    <div>${comment.content}</div>
                </div>
            `).join('');
        }

        // ëŒ“ê¸€ í•„í„°ë§
        function filterComments(filter) {
            currentFilter = filter;
            
            // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadComments();
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>
